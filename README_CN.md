# 乙羽的工具箱 (Yiyu's Toolbox)

[English](README.md)

一个基于 LaMa (Large Mask Inpainting) 模型的本地离线 AI 去水印/消除工具。

本项目早期是基于吾爱破解论坛 (52pojie.cn) 大神 **zhaoyun007** 的作品 "AI魔法消除小工具" 进行的重构与功能增强版本。

后续我有新的需求会逐渐添加功能，集成到这个工具中，会做什么功能，完全基于我的个人需求。

## 功能特点

- **离线 AI 修复**: 内置 LaMa 模型，无需联网即可高质量去除图片中的水印或杂物。
- **增强的交互界面**:
    - **画笔调节**: 支持 1-100 px 的画笔大小调节。
    - **缩放与平移**: 支持鼠标滚轮缩放，中键（按下滚轮）拖拽移动图片，方便处理细节。
    - **快速重绘**: 右键点击可一键清空当前蒙版。
- **批量处理模式**: 
    - 针对位置固定的水印（如相机时间戳、电视台Logo）提供批量处理功能。
    - **流程**: 自动读取文件夹首图 -> 绘制蒙版 -> 一键应用到全文件夹。
- **视频自动镜头分割**:
    - **批量处理**: 支持对文件夹内的视频进行批量处理。
    - **多种模式**: 支持提取镜头开始、中间、结束帧，或自动均分提取20张截图。
    - **智能保存**: 自动分类保存截图和视频文件。
- **便携性**: 旨在支持打包为单文件运行。

## 安装与运行

1.  **准备环境**:
    建议使用 Python 3.8 或更高版本 (开发环境为 3.11)。
    ```bash
    pip install -r requirements.txt
    ```
    *主要依赖: `torch`, `opencv-python`, `PyQt5`*

2.  **模型文件**:
    确保 `model/big-lama.pt` 文件存在。

3.  **启动**:
    ```bash
    # Windows 用户推荐直接运行
    run_source.bat
    
    # 或者
    python src/demo.py
    ```

## 使用指南

- **单图处理**:
    1. 点击 **"选取图片"** (橙色按钮)。
    2. 涂抹想要消除的区域。可配合 **滑块** 调整笔触，**滚轮** 缩放画布。
    3. 点击 **"开始去水印"** (绿色按钮) 等待处理完成。

- **批量处理**:
    1. 点击 **"批量处理(固定位置)"** (蓝色按钮)。
    2. 选择包含图片的文件夹。
    3. 程序会自动加载第一张图，在此图上画出水印位置。
    4. 点击 **"开始去水印"**，程序将自动处理该文件夹下的所有图片。
    *注意：批量处理仅适用于分辨率一致、水印位置一致的图片集合。*

    **详细批量操作步骤**:
    1.  程序加载第一张图片。
    2.  **绘制蒙版**: 在当前显示的图片上，使用画笔绘制出需要去除水印的区域（左键拖动，滚轮缩放，中键移动）。
    3.  **开始处理**: 绘制完成后，点击右侧绿色【开始去水印】按钮。
    4.  程序将自动把您绘制的蒙版应用到文件夹下所有图片。

- **视频分割**:
    1. 切换到 **"视频自动镜头分割"** 标签页。
    2. 点击 **"选择文件夹"** (蓝色按钮)，选中包含视频的目录。
    3. 选择截图模式（镜头开始/中间/结束/均分）。
    4. 点击 **"开始分割并保存截图"** (绿色按钮)，程序将自动批量处理。

## 输出目录说明

为保持源文件夹整洁，所有处理结果将统一保存到以下自动创建的子目录中：

- **单张/批量图片去水印**: 结果保存在原图目录下的 `images_output_yiyu_box` 文件夹中。
- **视频分割**: 结果保存在原视频目录下的 `videos_output_yiyu_box` 文件夹中。

## 致谢

- 原作者: **zhaoyun007** (52pojie.cn)
- 核心模型: [LaMa (Resolution-robust Large Mask Inpainting with Fourier Convolutions)](https://github.com/advimman/lama)

## 免责声明

本项目仅供学习交流使用，请勿用于非法用途。请尊重原模型及原作者的版权许可。
