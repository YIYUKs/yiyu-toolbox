# 乙羽的工具箱 (Yiyu's Toolbox)

[English](README.md)

一个基于 LaMa (Large Mask Inpainting) 模型的本地离线 AI 去水印/消除工具。

本项目早期是基于 **zhaoyun007** 的作品 "AI魔法消除小工具" 进行的重构与功能增强版本。

后续我有新的需求会逐渐添加功能，集成到这个工具中，会做什么功能，完全基于我的个人需求。

- **Premium 视觉体系**:
    - **深色模式**: 采用符合人体工学的深色主题，缓解视觉疲劳，界面更具专业感。
    - **双进度条系统**: 实时监控“总进度”与“当前单项进度”，任务状态一目了然，拒绝“黑盒热等待”。
    - **一致性布局**: 所有功能模块采用统一的瀑布流逻辑，学习成本极低。
- **便携性**: 旨在支持打包为完全独立的绿色版 EXE 运行。

## 🚀 Release v1.0 (最新发布)

**主要更新版本 1.0.0 (2026-01-02)**
- **UI 重塑**: 全新 Dark Mode 深度皮肤，完全重写的 `StyleManager`。
- **反馈增强**: 引入 Dual Progress Bar 机制，适配 AI 放大（Tiling）和批量抠图。
- **稳定性修复**: 优化了绿色版打包脚本，解决了部分环境下的 DLL 重定位错误。
- **交互优化**: 重新整理了去水印页面的操作逻辑，使其更加直观。

## 安装与运行

1.  **准备环境**:
    建议使用 Python 3.8 或更高版本 (开发环境为 3.11)。
    ```bash
    pip install -r requirements.txt
    ```
    *主要依赖: `torch`, `opencv-python`, `PyQt5`*

2.  **模型文件**:
    确保 `model/big-lama.pt` 文件存在。

3.  **启动**:
    ```bash
    # Windows 用户推荐直接运行
    run_source.bat
    
    # 或者
    python src/demo.py
    ```

## 构建便携版 (EXE)

如果您希望生成一个可以分发给通过、不需要安装 Python 就能运行的绿色便携版：

1.  确保 `resources` 目录下存在 `icon.ico` 文件（可选，用于生成带图标的 EXE）。
2.  双击运行 `create_portable_version.bat`。
3.  等待脚本执行完毕，将会在当前目录下生成 `yiyu_toolbox_portable` 文件夹。
4.  该文件夹即为最终成品，直接运行其中的 `乙羽的工具箱.exe` 即可。

## 使用指南

- **自动去水印**:
    1. 点击 **"选取图片"** (橙色按钮)。
    2. 涂抹想要消除的区域。可配合 **滑块** 调整笔触，**滚轮** 缩放画布。
    3. 点击 **"开始去水印"** (绿色按钮) 等待处理完成。

- **批量处理**:
    1. 点击 **"批量处理(固定位置)"** (蓝色按钮)。
    2. 选择包含图片的文件夹。
    3. 程序会自动加载第一张图，在此图上画出水印位置。
    4. 点击 **"开始去水印"**，程序将自动处理该文件夹下的所有图片。
    *注意：批量处理仅适用于分辨率一致、水印位置一致的图片集合。*

    **详细批量操作步骤**:
    1.  程序加载第一张图片。
    2.  **绘制蒙版**: 在当前显示的图片上，使用画笔绘制出需要去除水印的区域（左键拖动，滚轮缩放，中键移动）。
    3.  **开始处理**: 绘制完成后，点击右侧绿色【开始去水印】按钮。
    4.  程序将自动把您绘制的蒙版应用到文件夹下所有图片。

- **截取视频分镜**:
    1. 切换到 **"截取视频分镜"** 标签页。
    2. 点击 **"选择文件夹"** (蓝色按钮)，选中包含视频的目录。
    3. 选择截图模式（镜头开始/中间/结束/均分）。
    4. 点击 **"开始分割并保存截图"** (绿色按钮)，程序将自动批量处理。

- **90分自动抠图**:
    1. 切换到 **"90分自动抠图"** 标签页。
    2. 选择单图或文件夹。
    3. 选择 **边缘处理强度**（默认强烈建议选择“高”）。
    4. 点击 **"一键自动抠图"**，结果将保存为透明背景的 PNG 图片。

- **90分图片智能放大**:
    1. 切换到 **"90分图片智能放大"** 标签页。
    2. 选择单张图片或文件夹。
    3. 选择 **AI 模型**: 写实照片选“通用”，二次元选“动漫”。
    4. 点击 **"一键 AI 自动放大"**，初次运行会自动下载权重文件。

## 输出目录说明

为保持源文件夹整洁，所有处理结果将统一保存到以下自动创建的子目录中：

- **单张/批量图片去水印**: 结果保存在原图目录下的 `images_output_yiyu_box` 文件夹中。
- **截取视频分镜**: 结果保存在原视频目录下的 `videos_output_yiyu_box` 文件夹中。

## 致谢与开源项目

本项目集成了以下优秀的开源项目与模型，感谢原作者的贡献：

- **核心架构**:
    - [LaMa](https://github.com/advimman/lama): 强大的频率感知 AI 修复模型，本项目去水印的核心。
    - [BiRefNet](https://github.com/ZhengPeng7/BiRefNet): 高精度双向参考抠图网络，支撑“90分自动抠图”。
    - [Real-ESRGAN](https://github.com/xinntao/Real-ESRGAN): 业界领先的超分辨率重建模型。
- **底层支撑**:
    - [PyQt5](https://www.riverbankcomputing.com/software/pyqt/): 优秀的 Python GUI 框架。
    - [PyTorch](https://pytorch.org/): 深度学习推理引擎。
    - [OpenCV](https://opencv.org/): 基础图像处理库及导向滤波算法。
    - [PySceneDetect](https://github.com/Breakthrough/PySceneDetect): 视频场景检测算法。
    - [rembg](https://github.com/danielgatis/rembg): 抠图逻辑封装。
- **鸣谢**:
    - **zhaoyun007** (52pojie.cn)

## 免责声明

本项目仅供学习交流使用，请勿用于非法用途。请尊重原模型及原作者的版权许可。
